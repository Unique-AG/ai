name: Lint Python Project (Reusable)

# This is a reusable workflow for linting any Python project
# Currently not triggered automatically - use workflow_call from other workflows
# Example usage:
#   uses: ./.github/workflows/lint.yml
#   with:
#     project_directory: 'unique_mcp'

on:
  workflow_call:
    inputs:
      project_directory:
        description: 'Directory path to the Python project to lint'
        required: true
        type: string
  workflow_dispatch:
    inputs:
      project_directory:
        description: 'Directory path to the Python project to lint'
        required: true
        type: string
  
jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check if ruff is in dependencies
        id: check_ruff
        run: |
          if [ -f "${{ inputs.project_directory || '.' }}/pyproject.toml" ]; then
            if grep -q "ruff" "${{ inputs.project_directory || '.' }}/pyproject.toml"; then
              echo "ruff_found=true" >> $GITHUB_OUTPUT
            else
              echo "ruff_found=false" >> $GITHUB_OUTPUT
            fi
          else
            echo "ruff_found=false" >> $GITHUB_OUTPUT
          fi

      - name: Install package manager
        if: steps.check_ruff.outputs.ruff_found == 'true'
        id: install_pm
        uses: ./.github/actions/install-package-manager
        with:
          package_dir: ${{ inputs.project_directory || '.' }}
          package_manager: 'auto'
          python_version: '3.12'

      - name: Install dependencies
        if: steps.check_ruff.outputs.ruff_found == 'true'
        working-directory: ${{ inputs.project_directory || '.' }}
        run: |
          # Try with dev dependencies first, fall back to regular install
          if [[ "${{ steps.install_pm.outputs.install_cmd }}" == "poetry install" ]]; then
            poetry install --with dev || poetry install
          else
            uv sync --dev || uv sync
          fi

      - name: Run ruff check
        if: steps.check_ruff.outputs.ruff_found == 'true'
        working-directory: ${{ inputs.project_directory || '.' }}
        run: ${{ steps.install_pm.outputs.run_cmd }} ruff check .

      - name: Skip lint check
        if: steps.check_ruff.outputs.ruff_found == 'false'
        run: |
          echo "Skipping lint check: ruff is not found in ${{ inputs.project_directory || '.' }}/pyproject.toml dependencies"
          exit 0

