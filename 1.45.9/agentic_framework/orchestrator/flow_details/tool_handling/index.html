<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Unique Team">
        <link rel="canonical" href="https://unique-ag.github.io/ai/unique-toolkit/1.45.9/agentic_framework/orchestrator/flow_details/tool_handling/">
        <link rel="shortcut icon" href="../../../../img/favicon.ico">
        <title>üîß Tool Handling - Unique Toolkit</title>
        <link href="../../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../../../css/brands.min.css" rel="stylesheet">
        <link href="../../../../css/solid.min.css" rel="stylesheet">
        <link href="../../../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../../../assets/_mkdocstrings.css" rel="stylesheet">
        <link href="../../../../css/version-select.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../../..">Unique Toolkit</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../../../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../../../architectural/" class="nav-link">Architecture</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../../../setup/getting_started/" class="nav-link">Getting started</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Authentication</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../../authentication/#1-personal-api-key" class="dropdown-item">Personal API Key</a>
</li>
                                    
<li>
    <a href="../../../../authentication/#2-creating-an-app" class="dropdown-item">Creating an APP</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Application Development</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../../application_types/standalone_application/" class="dropdown-item">Standalone Application</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Event Driven Applications</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../application_types/event_driven/" class="dropdown-item">Event Driven App</a>
</li>
            
<li>
    <a href="../../../../application_types/event_driven/event_driven_platform_setup/" class="dropdown-item">Platform Setup</a>
</li>
            
<li>
    <a href="../../../../application_types/event_driven/event_driven_with_sse/" class="dropdown-item">SSE Setup</a>
</li>
            
<li>
    <a href="../../../../application_types/event_driven/event_driven_as_app_with_ngrok/" class="dropdown-item">Web Hooks</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Core Services</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../../events/events/" class="dropdown-item">Events</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Chat</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../chat/" class="dropdown-item">Chat Service - Basics</a>
</li>
            
<li>
    <a href="../../../../chat/advanced_rendering/" class="dropdown-item">Advanced Rendering</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Knowledge Base</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../knowledge_base/" class="dropdown-item">Knowledge Base Service</a>
</li>
            
<li>
    <a href="../../../../knowledge_base/smart_rules/" class="dropdown-item">Smart Rules</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Agentic Table</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../agentic_table/" class="dropdown-item">Agentic Table Module</a>
</li>
            
<li>
    <a href="../../../../agentic_table/column_styling/" class="dropdown-item">Column Styling</a>
</li>
            
<li>
    <a href="../../../../agentic_table/cell_rendering/" class="dropdown-item">Cell rendering</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Examples</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../../plattforms/openai/openai/" class="dropdown-item">OpenAI</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Chat</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../modules/examples/chat/chat_service/" class="dropdown-item">Basic Service</a>
</li>
            
<li>
    <a href="../../../../modules/examples/chat/chat_document_handling/" class="dropdown-item">Document Handling</a>
</li>
            
<li>
    <a href="../../../../modules/examples/chat/advanced_rendering/" class="dropdown-item">Advanced Rendering</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Knowledge Base</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../modules/examples/content/kb_service/" class="dropdown-item">Base Service</a>
</li>
            
<li>
    <a href="../../../../modules/examples/content/smart_rules/" class="dropdown-item">Smart Rules</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Tutorials</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../../tutorials/agentic_table_app/" class="dropdown-item">Agentic Table App</a>
</li>
                                    
<li>
    <a href="../../../../tutorials/file_creation_and_upload_to_chat/" class="dropdown-item">File Creation with Upload to Chat</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Agentic Framework</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../framework/" class="dropdown-item">Overview</a>
</li>
                                    
<li>
    <a href="../../unqiue_ai_how-it-works/" class="dropdown-item">Orchestrator</a>
</li>
                                    
<li>
    <a href="../../../tool/" class="dropdown-item">Tool</a>
</li>
                                    
<li>
    <a href="../../../tool_call_response/" class="dropdown-item">Tool Call Response</a>
</li>
                                    
<li>
    <a href="../../../tool_manager/" class="dropdown-item">Tool Manager</a>
</li>
                                    
<li>
    <a href="../../../debug_manager/" class="dropdown-item">Debug Info Manager</a>
</li>
                                    
<li>
    <a href="../../../postprocessor_manager/" class="dropdown-item">Postprocessor Manager</a>
</li>
                                    
<li>
    <a href="../../../evaluation_manager/" class="dropdown-item">Evaluation Manager</a>
</li>
                                    
<li>
    <a href="../../../reference_manager/" class="dropdown-item">Reference Manager</a>
</li>
                                    
<li>
    <a href="../../../history_manager/" class="dropdown-item">History Manager</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">API Reference</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../../api/" class="dropdown-item">Overview</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Core Services</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../modules/chat/" class="dropdown-item">Chat Module</a>
</li>
            
<li>
    <a href="../../../../modules/knowledge_base/" class="dropdown-item">Knowledge Base Module</a>
</li>
            
<li>
    <a href="../../../../modules/short_term_memory/" class="dropdown-item">Short Term Memory Module</a>
</li>
            
<li>
    <a href="../../../../modules/app/" class="dropdown-item">App Module</a>
</li>
            
<li>
    <a href="../../../../modules/content_smart_rules/" class="dropdown-item">Smart Rules</a>
</li>
            
<li>
    <a href="../../../../modules/data_extraction/" class="dropdown-item">Data Extraction</a>
</li>
            
<li>
    <a href="../../../../modules/agentic_table/" class="dropdown-item">Agentic Table</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Framework Utilities</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../modules/openai/" class="dropdown-item">OpenAI Client</a>
</li>
            
<li>
    <a href="../../../../modules/langchain/" class="dropdown-item">Langchain Client</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Deprecated Modules</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../modules/content/" class="dropdown-item">Content Module</a>
</li>
            
<li>
    <a href="../../../../modules/embedding/" class="dropdown-item">Embedding Module</a>
</li>
            
<li>
    <a href="../../../../modules/language_model/" class="dropdown-item">Language Model Module</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a href="../../../../readme/" class="nav-link">Readme</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a href="https://github.com/docs/agentic_framework/orchestrator/flow_details/tool_handling.md" class="nav-link">Edit on Unique-AG/ai/unique_toolkit
                                    </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#tool-handling" class="nav-link">üîß Tool Handling</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#_handle_tool_calls" class="nav-link">_handle_tool_calls()</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="tool-handling">üîß Tool Handling<a class="headerlink" href="#tool-handling" title="Permanent link">&para;</a></h1>
<h2 id="_handle_tool_calls">_handle_tool_calls()<a class="headerlink" href="#_handle_tool_calls" title="Permanent link">&para;</a></h2>
<p>When the LLM returns tool calls:
1. Append tool calls to history
2. Execute tool calls via ToolManager
3. Extract referenceable chunks from tool results
4. Collect debug info from tools
5. Add tool results to history
6. Return whether a tool took control (to exit the loop if true)</p>
<p>When the model proposes tool calls, the orchestrator has to do more than merely ‚Äúrun them.‚Äù</p>
<p>Here‚Äôs the reasoning behind each step:</p>
<ol>
<li>Append tool calls to history ‚Äî before execution
The conversation history must reflect the model‚Äôs intent at the moment it decided to act. By writing the tool calls into the HistoryManager first, we preserve a verifiable chain of decision ‚Üí action. This makes subsequent model calls reproducible: on the next iteration, the LLM sees exactly which tools it requested and in what order.</li>
<li>
<p>Execute tool calls via ToolManager
The ToolManager centralizes the parallel execution of the tools. Keeping execution behind a single interface reduces coupling in the orchestrator and ensures every tool adheres to a consistent contract.</p>
</li>
<li>
<p>Extract referenceable chunks from tool results
Tools can produce citable references as part of the <code>ToolCallResponse</code>. The ReferenceManager collects them to allow the citation by the model during the execution of <code>complete_with_references_async</code>. 
Multiple tools can produce citable references and all of them must be numbered correctly and brought into a standardized format for citation by the ReferenceManager.</p>
</li>
<li>
<p>Collect debug info from tools
Operational visibility matters. If a tool times out, returns a partial payload, or hits an API limit, the DebugInfoManager captures this without polluting the user-facing content. These traces are invaluable for developer diagnosis and for adaptive logic (e.g., future retries, fallbacks).
For easier debugging in production and richer telemetry without exposing noisy internals to end users.</p>
</li>
<li>Add tool results to history
Mich like in "Append tool calls to history" step the The model‚Äôs next reasoning step must be informed about the actual tool outputs (not just that a tool was called). </li>
<li>Return whether a tool ‚Äútakes control‚Äù
Some tools aren‚Äôt just data fetchers ‚Äî they‚Äôre specialized agents (e.g., deep research, long-running pipelines) that assume full streaming and control. If ToolManager.does_a_tool_take_control() returns true, the orchestrator stops its loop to handoff control to the subagent.</li>
</ol>
<p>This ordering preserves causal integrity (what was intended vs. what happened), equips the next iteration with usable evidence, and makes space for expert agents to take over when it‚Äôs appropriate.</p>
<p>Code:
<div class="highlight"><pre><span></span><code>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_handle_tool_calls</span><span class="p">(</span>
          <span class="bp">self</span><span class="p">,</span> <span class="n">loop_response</span><span class="p">:</span> <span class="n">LanguageModelStreamResponse</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the case where tool calls are returned.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Processing tool calls&quot;</span><span class="p">)</span>

        <span class="n">tool_calls</span> <span class="o">=</span> <span class="n">loop_response</span><span class="o">.</span><span class="n">tool_calls</span> <span class="ow">or</span> <span class="p">[]</span>

        <span class="c1"># Append function call to history</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_history_manager</span><span class="o">.</span><span class="n">_append_tool_calls_to_history</span><span class="p">(</span><span class="n">tool_calls</span><span class="p">)</span>

        <span class="c1"># Execute tool calls</span>
        <span class="n">tool_call_responses</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tool_manager</span><span class="o">.</span><span class="n">execute_selected_tools</span><span class="p">(</span>
              <span class="n">tool_calls</span>
        <span class="p">)</span>

        <span class="c1"># Process results with error handling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reference_manager</span><span class="o">.</span><span class="n">extract_referenceable_chunks</span><span class="p">(</span>
              <span class="n">tool_call_responses</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_debug_info_manager</span><span class="o">.</span><span class="n">extract_tool_debug_info</span><span class="p">(</span><span class="n">tool_call_responses</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_iteration_index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_history_manager</span><span class="o">.</span><span class="n">add_tool_call_results</span><span class="p">(</span><span class="n">tool_call_responses</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tool_manager</span><span class="o">.</span><span class="n">does_a_tool_take_control</span><span class="p">(</span><span class="n">tool_calls</span><span class="p">)</span>
</code></pre></div></p>
<p>Notes:
- ‚ÄúTool takes control‚Äù scenarios (e.g., deep research) stop the orchestrator‚Äôs loop and hand over streaming to the tool/agent.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../../js/base.js"></script>
        <script src="../../../../search/main.js"></script>
        <script src="../../../../js/version-select.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
